<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="css/profile.css" rel="stylesheet">

    <script src="https://fb.me/react-0.14.5.js"></script>
    <script src="https://fb.me/react-dom-0.14.5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>

    <div class="row" id="header"></div>
    <meta charset="UTF-8">
    <title>New Host Registration</title>
</head>
<body>
    <div class="container">
        <h1>Create New Host</h1>
        <hr>
        <form id="hostInput">
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" class="form-control" id="name" placeholder="Name" required>
            </div>
            <div class="form-group">
                <label for="description">Description</label>
                <textarea class="form-control" rows="5" id="description" placeholder="Describe your event/restaurant here" required></textarea>
            </div>
            <div class="form-group" id="itemList">
                <h3>Add items</h3>
                <div class="row">
                    <div class=" col-md-1">Item 1 </div>
                    <div class=" col-md-4"><input type="text"class="form-control" id="itemName1" placeholder="name of your item" required></div>
                    <div class=" col-md-2"><input class="form-control" type='number' id='price1' placeholder="price..." step="any" required></div>
                </div>

            </div>
            <input type="button" value="Add another text input" class = "btn btn-default" onClick="addInput('itemList');">
            <input type="button" value="Remove last text input" class = "btn btn-default" onClick="removeInput('itemList');">

            <button type="submit" class="btn btn-default">Submit</button>
        </form>
    </div>

</body>

<!-- Footer -->
<footer>
    <div class="row" id="footer"></div>
</footer>

<!-- jQuery -->
<script src="js/jquery-2.2.1.min.js"></script>

<script>
    var counter = 1;
    var limit = 50;

    $( "#hostInput" ).submit(function(e){
        e.preventDefault();

        if(document.cookie.split('=')[0] != "token"){
            alert("User not login! Redirecting...");
            window.location.href = "/login.html";
        }
        console.log( document.cookie.split('=')[1]);

        var items = [];
        var prices= [];
        for(var i = 0; i < counter ; i++){
            items[i] = $( "#itemName" + (i + 1) ).val();
            prices[i] = $( "#price" + (i + 1) ).val();
        }

        console.log(items);
        console.log(prices);


         $.post( "/host/add",
                 {

                     "name" : $( "#name" ).val(),
                     "description":$( "#description" ).val(),
                     "token": document.cookie.split('=')[1],
                     "items" : JSON.stringify(items),
                     "prices" : JSON.stringify(prices)
                 }
         )
         .done(function(data) {
             if(data.success === undefined){
                 window.location.href = data;
             }
             else{
                 alert("Please login!");
                 window.location.href = "/login.html";
             }
             return;
        }).error();

    })


    function addInput(divName){
        if (counter == limit)  {
            alert("You have reached the limit of adding " + counter + " inputs");
        }
        else {
            var newdiv = document.createElement('div');
            newdiv.innerHTML = "<div class='row'><div class='col-md-1'>Item " + (counter + 1) + "</div>"
                    + "<div class='col-md-4'><input type='text' class='form-control' id='itemName"+(counter + 1)+"' required></div>"
                    +" <div class='col-md-2'><input type='text' class='form-control' id='price"+(counter + 1)+"'  step='any' required></div></div></div>" ;
            document.getElementById(divName).appendChild(newdiv);
            counter++;
        }
    }
    function removeInput(divName){
        if(counter > 1){
            var itemsList = document.getElementById(divName);
            itemsList.removeChild(itemsList.lastChild);
            counter--;
        }
    }

</script>
<!-- Bootstrap Core JavaScript -->
<script type="text/babel" src="js/Header.js"></script>
<script src="js/bootstrap.min.js"></script>

</html>